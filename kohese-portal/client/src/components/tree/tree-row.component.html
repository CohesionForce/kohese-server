<ng-container *ngIf="visible">
  <div class="kt-collection">
    <div class="kt-item" id="{{itemProxy.item.id}}"
      [ngClass]="{ 'kti-selected-item': (itemProxy.item.id === getSelectedProxyId()) }">
      <div class="kti-name" [style]="{'font-weight': 'bold'}"
        (click)="navigate('Explore', {id: itemProxy.item.id})">
        <i (click)="collapsed = !collapsed;" class="kt-icon fa"
          [ngClass]="{ 'fa-caret-down': (itemProxy.children.length > 0) && !collapsed,
          'fa-caret-right': (itemProxy.children.length > 0) && collapsed,
          'no-icon': !(itemProxy.children.length > 0) }">
        </i>
        <span>
          <mat-icon class="{{koheseType.icon}}" matTooltip="{{koheseType.name}}">
          </mat-icon>
        </span>
        <span class="kt-label">
          {{(itemProxy.item.name | highlightRegex )}}
        </span>
        <span *ngIf="itemProxy.item.tags"> {{itemProxy.item.tags}}</span>
        <!-- Conditional Icons for Item status -->
        <span *ngIf="itemProxy.dirty">
          <img src="assets/icons/versioncontrol/dirty.ico"
            title = "Dirty item"/>
        </span>
        <span *ngIf="isVersionControlViewVisible()">
          {{itemProxy.status}}
        </span>
      </div>
      <div class="kti-cell kti-actions pull-right">
        <!-- Default row actions -->
        <span *ngIf="!isVersionControlViewVisible()">
          <button mat-icon-button [matMenuTriggerFor]="menu">
            <mat-icon class="fa fa-gear"></mat-icon>
          </button>
          <mat-menu #menu="matMenu">
            <ng-container
              *ngIf="((stateService.getTransitionCandidates(itemProxy) | mapKey).length > 0)">
              <button mat-menu-item [matMenuTriggerFor]="transitionMenu">
                Transition To...
              </button>
            </ng-container>
          </mat-menu>
          <mat-menu #transitionMenu="matMenu">
            <ng-container
              *ngFor="let fieldName of (stateService.getTransitionCandidates(itemProxy) | mapKey)">
              <button mat-menu-item
                *ngFor="let candidate of stateService.getTransitionCandidates(itemProxy)[fieldName]; let j = index"
                (click)="openTransitionDialog(fieldName, candidate.target)">
                {{koheseType.stateFlows[fieldName][candidate.target].name}}
              </button>
            </ng-container>
          </mat-menu>
          <i class="fa fa-anchor" (click)="updateRoot()">
          </i>
          <i class="glyphicon glyphicon-remove pull-right"
            (click)="removeItem()">
          </i>
        </span>
        <!-- Version Control row actions -->
        <span *ngIf="isVersionControlViewVisible() && itemProxy.vcState">
          <!-- VC Status Icons -->
          <img *ngIf="itemProxy.vcState.Unstaged"
            src="assets/icons/versioncontrol/unstaged.ico" title="Unstaged"/>
          <img *ngIf="itemProxy.vcState.Staged"
            src="assets/icons/versioncontrol/index-mod.ico" title="Staged"/>
          <!-- Actions -->
          <i class="fa fa-undo kt-icon"
            (click)="revertChanges()">
          </i>
          <i class="fa fa-plus kt-icon" *ngIf="itemProxy.vcState.Unstaged"
            (click)="versionControlService.stageItems([itemProxy])">
          </i>
          <i class="fa fa-minus kt-icon" *ngIf="itemProxy.vcState.Staged"
            (click)="versionControlService.unstageItems([itemProxy])">
          </i>
        </span>
      </div>
    </div>
    <ng-container *ngIf="!collapsed">
      <tree-row *ngFor="let childProxy of itemProxy.children"
        [itemProxy]="childProxy">
      </tree-row>
    </ng-container>
  </div>
</ng-container>
