<div *ngIf="root">
  <div id="top-action-bar">
    <button mat-raised-button (click)="expandAll()"
      class="btn btn-default btn-sm">
      Expand All
    </button>
    <button mat-raised-button (click)="expandFiltered()"
      class="btn btn-default btn-sm">
      Expand Filtered
    </button>
    <button mat-raised-button (click)="collapseAll()"
      class="btn btn-default btn-sm">
      Collapse All
    </button>
    <button mat-raised-button class="btn btn-default btn-sm" (click)="upLevel()"
      [disabled]="isRootDefault">
      Up Level
    </button>
    <button mat-raised-button class="btn btn-default btn-sm" (click)="resetRoot()"
      [disabled]="isRootDefault">
      Reset Root
    </button>
    <i (click)="syncLocation()"
      [ngClass]="{ 'btn-green': locationSynced}"
      class="btn btn-default btn-sm fa fa-exchange">
    </i>
      <span>Showing {{numberOfRowsVisible}} of
        {{root.descendantCount}}
      </span>
    <div>
      <!-- Start View Control -->
      <mat-form-field>
        <mat-select placeholder="View"
          (selectionChange)="viewSelectionChanged($event.value)">
          <mat-option *ngFor="let view of viewList" [value]="view">
            {{view}}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <!-- Start View Forking -->
      <ng-container [ngSwitch]="(selectedViewStream | async)">
        <!-- Start Default Toolbar -->
        <ng-container *ngSwitchCase="viewList[0]">
          <!-- Kind Selection -->
          <mat-form-field>
            <mat-select placeholder="Kind" [(value)]="proxyFilter.kind"
              (selectionChange)="filter()">
              <mat-option>{{NO_KIND_SPECIFIED}}</mat-option>
              <mat-option *ngFor="let type of (koheseTypes | mapKey)"
                [value]="koheseTypes[type]">
                {{type}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <!-- Action Filtering -->
          <ng-container
            *ngIf="(proxyFilter.kind && (proxyFilter.kind.name === 'Action'))">
            <mat-form-field>
              <mat-select placeholder="State" [(value)]="proxyFilter.actionState"
                (selectionChange)="filter()">
                <mat-option *ngFor="let state of actionStates" [value]="state">
                  {{state}}
                </mat-option>
              </mat-select>
            </mat-form-field>
            <mat-form-field>
              <mat-select placeholder="Assignee" [(value)]="proxyFilter.actionAssignee"
                (selectionChange)="filter()">
                <mat-option *ngFor="let user of userList" [value]="user.item.name">
                  {{user.item.name}}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </ng-container> <!-- End Action Filtering -->
          <!-- String Filtering -->
          <mat-form-field>
            <input matInput type="text" [(ngModel)]="proxyFilter.filterString"
              [ngStyle]="proxyFilter.invalidRegex && {'background-color':'pink'}"
              placeholder="Filter" (input)="filter()"/>
          </mat-form-field>
          <!-- Version Control Filtering -->
          <mat-checkbox [(ngModel)]="proxyFilter.status" (change)="filter()">
            Modified
          </mat-checkbox>
          <mat-checkbox [(ngModel)]="proxyFilter.dirty" (change)="filter()">
            Dirty
          </mat-checkbox>
          <!-- End Version Control Filtering -->
        </ng-container>	<!-- End Default Controls -->
        <!-- Start Version Control View -->
        <ng-container *ngSwitchCase="viewList[1]">
        </ng-container>
      </ng-container> <!-- End Switch on View Type -->
    </div>
  </div>
  <!-- Begin Knowledge Tree -->
  <div class="knowledge-tree-panel">
    <div class="kt-head kth-cell kti-name">
      Name
    </div>
    <div class="kt-body">
      <tree-row #rows *ngFor="let proxy of root.children"
        [itemProxy]="proxy" (rootChanged)="whenRootChanges($event)"
        [selectedViewStream]="selectedViewStream"
        [selectedProxyIdStream]="selectedProxyIdStream"
        [filterStream]="filterStream"
        (visibilityChanged)="whenRowVisibilityChanges($event)">
      </tree-row>
    </div>
  </div> <!-- End Knowledge Tree -->
</div>
<div *ngIf="!root">
  Loading...
</div>
