<mat-drawer-container [ngStyle]="{ 'height': isDialogInstance() ?
  'calc(100% - 40px)' : '100%' }">
  <mat-drawer #quickSelectDrawer mode="side" disableClose
    [opened]="(quickSelectElements.length > 0)" style="width: 25%;">
    <div style="height: 50px;">
      <h3>
        Quick Select
      </h3>
    </div>
    <div style="height: calc(100% - 50px); overflow-y: auto;">
      <ng-container *ngFor="let quickSelectElement of quickSelectElements">
        <div style="display: flex; flex-direction: row;">
          <button mat-button matTooltip="{{elementMap.get(quickSelectElement)?.
            text}}" (click)="changeElementSelection(quickSelectElement)"
            [ngClass]="{ 'highlight': (selection.indexOf(quickSelectElement) !==
            -1) }" style="white-space: nowrap; overflow: hidden; text-overflow:
            ellipsis; width: 100%; text-align: left;">
            <mat-icon class="{{elementMap.get(quickSelectElement)?.icon}}">
            </mat-icon>
            {{elementMap.get(quickSelectElement)?.text}}
          </button>
          <button mat-icon-button matTooltip="Display this element in the tree"
            (click)="scrollElementIntoView(quickSelectElement)"
            style="margin-left: auto;">
            <mat-icon class="fa fa-arrow-circle-o-right"></mat-icon>
          </button>
        </div>
      </ng-container>
    </div>
  </mat-drawer>
  <mat-drawer-content>
    <div style="height: 70px; width: 100%; display: flex; flex-direction:
      row;">
      <ng-container *ngIf="(quickSelectElements.length > 0)">
        <button mat-icon-button matTooltip="Toggle display of the Quick Select
          area" [ngClass]="{ 'highlight': quickSelectDrawer.opened }"
          (click)="quickSelectDrawer.toggle()">
          <mat-icon class="fa fa-bolt"></mat-icon>
        </button>
      </ng-container>
      <button mat-icon-button matTooltip="Expand all"
        (click)="changeAllExpansionStates(true)">
        <mat-icon class="fa fa-caret-right"></mat-icon>
      </button>
      <button mat-icon-button matTooltip="Collapse all"
        (click)="changeAllExpansionStates(false)">
        <mat-icon class="fa fa-caret-down"></mat-icon>
      </button>
      <ng-container *ngIf="allowMultiselect">
        <button mat-icon-button matTooltip="Select all elements"
          (click)="changeSelectionOfAll(true)">
          <mat-icon class="fa fa-check-square-o"></mat-icon>
        </button>
        <button mat-icon-button matTooltip="De-select all elements"
          (click)="changeSelectionOfAll(false)">
          <mat-icon class="fa fa-square-o"></mat-icon>
        </button>
      </ng-container>
      <mat-form-field style="width: 100%;" class="flex-right-align">
        <input matInput type="text" placeholder="Search"
          (input)="searchTextChanged($event.target.value)"/>
      </mat-form-field>
    </div>
    <div #elementContainer style="height: calc(100% - 70px); width: 100%;">
      <ng-container *ngFor="let element of Array.from(elementMap.keys())">
        <ng-container *ngIf="shouldDisplay(element)">
          <div style="height: 40px; width: 100%; display: flex; flex-direction:
            row;" [ngStyle]="getElementStyle(element)">
            <ng-container *ngIf="!elementMap.get(element).expanded">
              <mat-icon class="fa fa-caret-right" style="width: 7%;
                text-align: center; padding-top: 10px;"
                [ngStyle]="getExpansionIconStyle(element)"
                (click)="changeSingleExpansionState(element, true); $event.
                stopPropagation()">
              </mat-icon>
            </ng-container>
            <ng-container *ngIf="elementMap.get(element).expanded">
              <mat-icon class="fa fa-caret-down" style="width: 7%;
                text-align: center; padding-top: 10px;"
                [ngStyle]="getExpansionIconStyle(element)"
                (click)="changeSingleExpansionState(element, false); $event.
                stopPropagation()">
              </mat-icon>
            </ng-container>
            <span style="width: 93%; display: flex; flex-direction: row;">
              <button mat-button matTooltip="{{elementMap.get(element).
                text}}" (click)="changeElementSelection(element)"
                [ngClass]="{ 'highlight': (selection.indexOf(element) !==
                -1) }" style="white-space: nowrap; overflow: hidden;
                text-overflow: ellipsis; width: 100%; text-align: left;">
                <mat-icon class="{{elementMap.get(element).icon}}"></mat-icon>
                {{elementMap.get(element).text}}
              </button>
              <ng-container *ngFor="let action of actions; let j = index">
                <button mat-icon-button matTooltip="{{action.tooltip}}"
                  [disabled]="!action.canExecute(element)"
                  [ngClass]="{ 'highlight': (action.isSelected &&
                  action.isSelected(element)), 'flex-right-align': (j ===
                  0) }" (click)="action.execute(element)">
                  <mat-icon class="{{action.classes}}"></mat-icon>
                </button>
              </ng-container>
            </span>
          </div>
        </ng-container>
      </ng-container>
    </div>
  </mat-drawer-content>
  <mat-drawer mode="side" position="end" disableClose
    [opened]="(allowMultiselect && showSelections)" style="width: 15%;">
    <div style="height: 50px; display: flex; flex-direction: row;">
      <h3>
        Selected:
      </h3>
      <h3 style="margin-left: auto;">
        {{selection.length}}
      </h3>
    </div>
    <div style="height: calc(100% - 50px); overflow-y: auto;">
      <ng-container *ngFor="let selectionEntry of selection">
        <div style="display: flex; flex-direction: row;">
          <button mat-button matTooltip="{{elementMap.get(selectionEntry)?.
            text}}" (click)="scrollElementIntoView(selectionEntry)"
            style="white-space: nowrap; overflow: hidden; text-overflow:
            ellipsis; width: 100%; text-align: left;">
            <mat-icon class="{{elementMap.get(selectionEntry)?.icon}}">
            </mat-icon>
            {{elementMap.get(selectionEntry)?.text}}
          </button>
          <button mat-icon-button matTooltip="De-select this element"
            (click)="changeElementSelection(selectionEntry)"
            style="margin-left: auto;">
            <mat-icon class="fa fa-times"></mat-icon>
          </button>
        </div>
      </ng-container>
    </div>
  </mat-drawer>
</mat-drawer-container>
<ng-container *ngIf="isDialogInstance()">
  <mat-dialog-actions style="height: 40px; display: flex; flex-direction:
    row;">
    <button mat-button matTooltip="Select these elements"
      [disabled]="selection.length === 0" class="flex-right-align"
      (click)="matDialogRef.close(selection)">
      Select
    </button>
    <button mat-button matTooltip="Cancel the selection process"
      (click)="matDialogRef.close(undefined)">
      Cancel
    </button>
  </mat-dialog-actions>
</ng-container>
