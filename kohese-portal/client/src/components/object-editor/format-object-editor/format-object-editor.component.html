<div style="width: 100%; display: flex; flex-direction: column; overflow: auto;
  padding: 7px;" [ngStyle]="{ 'height': isDialogInstance() ?
  'calc(100% - 40px)' : '100%' }">
  <ng-container *ngIf="(allowKindChange && (types.length > 1))">
    <mat-form-field style="width: 100%;">
      <mat-select placeholder="Kind" [(ngModel)]="selectedType">
        <ng-container *ngFor="let typeOption of types">
          <mat-option [value]="typeOption">
            {{typeOption.name}}
          </mat-option>
        </ng-container>
      </mat-select>
    </mat-form-field>
  </ng-container>
  <ng-container *ngFor="let container of formatDefinition.containers">
    <ng-container *ngIf="(container.kind === FormatContainerKind.
      REVERSE_REFERENCE_TABLE) else notReverseReferencesTable">
      <h3>
        Reverse References For {{getReverseReferenceTableHeaderContent(
          container)}}
      </h3>
      <table_ [rows]="getReverseReferences(container)"
        [getName]="getReverseReferenceName" [columns]="['name']"
        [disabled]="true">
      </table_>
    </ng-container>
    <ng-template #notReverseReferencesTable>
      <div style="display: flex;" [ngStyle]="{ 'flex-direction': ((container.
        kind === 'list') ? 'column' : 'row') }">
        <ng-container *ngFor="let attributeDefinition of container.contents">
          <ng-container *ngIf="Array.isArray(selectedType.classProperties[
            attributeDefinition.propertyName].definition.type) else
            singleValuedBlock">
            <ng-container *ngIf="(!isDisabled || attributeDefinition.visible)">
              <ng-container *ngIf="attributeDefinition.tableDefinition else
                notTableBlock">
                <h3>
                  {{getAttributeRepresentation(attributeDefinition)}}
                </h3>
                <table_ [rows]="getTableElements(attributeDefinition)"
                  [getName]="getTableElementName" [columns]="getTableColumns(
                  attributeDefinition)" [add]="getTableElementAdditionFunction(
                  attributeDefinition)"
                  [move]="getTableElementMovementFunction(attributeDefinition)"
                  [remove]="getTableElementRemovalFunction(
                  attributeDefinition)" [disabled]="(!attributeDefinition.
                  editable || isDisabled)">
                </table_>
              </ng-container>
              <ng-template #notTableBlock>
                <div style="display: flex; flex-direction: column;">
                  <div style="display: flex; flex-direction: row;">
                    <h3>
                      {{getAttributeRepresentation(attributeDefinition)}}
                    </h3>
                    <button mat-icon-button matTooltip="Add a value to
                      {{attributeDefinition.propertyName}}"
                      class="flex-right-align"
                      [disabled]="(!attributeDefinition.editable ||
                      isDisabled)" (click)="addValue(attributeDefinition)">
                      <mat-icon class="fa fa-plus"></mat-icon>
                    </button>
                  </div>
                  <div style="height: 140px; overflow-y: auto;">
                    <ng-container *ngFor="let value of object[
                      attributeDefinition.propertyName]; let j = index">
                      <div style="display: flex; flex-direction: row;">
                        <button mat-button
                          matTooltip="{{getStringRepresentation(j,
                          attributeDefinition.propertyName)}}"
                          [disabled]="(!attributeDefinition.editable ||
                          isDisabled)" (click)="editValue(j,
                          attributeDefinition)" style="white-space: nowrap;
                          overflow: hidden; text-overflow: ellipsis; width:
                          100%; text-align: left;">
                          {{getStringRepresentation(j, attributeDefinition.
                            propertyName)}}
                        </button>
                        <button mat-icon-button matTooltip="Remove this
                          value" [disabled]="(!attributeDefinition.
                          editable || isDisabled)" (click)="removeValue(j,
                          attributeDefinition.propertyName)"
                          style="margin-left: auto;">
                          <mat-icon class="fa fa-times"></mat-icon>
                        </button>
                      </div>
                    </ng-container>
                  </div>
                </div>
              </ng-template>
              <br/>
            </ng-container>
          </ng-container>
          <ng-template #singleValuedBlock>
            <ng-container *ngIf="(!isDisabled || attributeDefinition.visible)">
              <ng-container [ngSwitch]="attributeDefinition.kind">
                <ng-container *ngSwitchCase="'boolean'">
                  <mat-checkbox [(ngModel)]="object[attributeDefinition.
                    propertyName]" [disabled]="(!attributeDefinition.
                    editable || isDisabled)" style="width: 100%;">
                    {{getAttributeRepresentation(attributeDefinition)}}
                  </mat-checkbox>
                </ng-container>
                <ng-container *ngSwitchCase="'number'">
                  <mat-form-field style="width: 100%;">
                    <input matInput type="number"
                      placeholder="{{getAttributeRepresentation(
                      attributeDefinition)}}" [(ngModel)]="object[
                      attributeDefinition.propertyName]"
                      [disabled]="(!attributeDefinition.editable ||
                      isDisabled)"/>
                  </mat-form-field>
                </ng-container>
                <ng-container *ngSwitchCase="'date'">
                  <mat-form-field style="width: 100%;">
                    <input matInput type="date"
                      placeholder="{{getAttributeRepresentation(
                      attributeDefinition)}}" [(ngModel)]="object[
                      attributeDefinition.propertyName]"
                      [disabled]="(!attributeDefinition.editable ||
                      isDisabled)"/>
                  </mat-form-field>
                </ng-container>
                <ng-container *ngSwitchCase="'string'">
                  <mat-form-field style="width: 100%;">
                    <input matInput type="text"
                      placeholder="{{getAttributeRepresentation(
                      attributeDefinition)}}" [(ngModel)]="object[
                      attributeDefinition.propertyName]"
                      [disabled]="(!attributeDefinition.editable ||
                      isDisabled)"/>
                  </mat-form-field>
                </ng-container>
                <!-- Hopefully the case below can be removed eventually. -->
                <ng-container *ngSwitchCase="'text'">
                  <mat-form-field style="width: 100%;">
                    <input matInput type="text"
                      placeholder="{{getAttributeRepresentation(
                      attributeDefinition)}}" [(ngModel)]="object[
                      attributeDefinition.propertyName]"
                      [disabled]="(!attributeDefinition.editable ||
                      isDisabled)"/>
                  </mat-form-field>
                </ng-container>
                <ng-container *ngSwitchCase="'markdown'">
                  <ng-container *ngIf="(!attributeDefinition.editable ||
                    isDisabled) else editableBlock">
                    <label style="width: 100%;">
                      {{getAttributeRepresentation(attributeDefinition)}}:
                    </label>
                    <markdown [data]="object[attributeDefinition.
                      propertyName]">
                    </markdown>
                  </ng-container>
                  <ng-template #editableBlock>
                    <markdown-editor [value]="object[attributeDefinition.
                      propertyName]"
                      [valueIdentifier]="getAttributeRepresentation(
                      attributeDefinition)" (valueChanged)="object[
                      attributeDefinition.propertyName] = $event"
                      style="height: 250px;">
                    </markdown-editor>
                    <br/>
                  </ng-template>
                </ng-container>
                <ng-container *ngSwitchCase="'state-editor'">
                  <div style="display: flex; flex-direction: row;">
                    <div style="display: flex; flex-direction: column;
                      justify-content: center;">
                      <label style="margin-bottom: unset;">
                        {{getAttributeRepresentation(attributeDefinition)}}:
                          {{object[attributeDefinition.propertyName]}}&nbsp;
                      </label>
                    </div>
                    <ng-container *ngFor="let transitionCandidateName of
                      getStateTransitionCandidates(attributeDefinition);
                      let j = index">
                      <button mat-raised-button
                        [disabled]="(!attributeDefinition.editable ||
                        isDisabled)" style="margin: 0px 3px 0px 3px;"
                        [ngStyle]="{ 'margin-left': ((j === 0) ? 'auto' :
                        '') }" (click)="object[attributeDefinition.
                        propertyName] = selectedType.classProperties[
                        attributeDefinition.propertyName].definition.
                        properties.transition[transitionCandidateName].target">
                        {{transitionCandidateName}}
                      </button>
                    </ng-container>
                  </div>
                </ng-container>
                <ng-container *ngSwitchCase="'user-selector'">
                  <mat-form-field style="width: 100%;">
                    <mat-select placeholder="{{getAttributeRepresentation(
                      attributeDefinition)}}" [(ngModel)]="object[
                      attributeDefinition.propertyName]"
                      [disabled]="(!attributeDefinition.editable ||
                      isDisabled)">
                      <ng-container *ngFor="let username of usernames">
                        <mat-option [value]="username">
                          {{username}}
                        </mat-option>
                      </ng-container>
                    </mat-select>
                  </mat-form-field>
                </ng-container>
                <ng-container *ngSwitchDefault>
                  <ng-container *ngIf="isLocalTypeAttribute(
                    attributeDefinition.propertyName) else
                    globalTypeAttribute">
                    <label style="width: 100%;">
                      {{getAttributeRepresentation(
                        attributeDefinition)}}:&nbsp;
                    </label>
                    <br/>
                    <format-object-editor [enclosingType]="selectedType"
                      [object]="object[attributeDefinition.propertyName]"
                      [type]="getLocalType(attributeDefinition)"
                      [formatDefinitionType]="formatDefinitionType"
                      [disabled]="(!attributeDefinition.editable ||
                      isDisabled)">
                    </format-object-editor>
                  </ng-container>
                  <ng-template #globalTypeAttribute>
                    <div style="width: 100%; display: flex; flex-direction:
                      row; align-items: center;">
                      <label>
                        {{getAttributeRepresentation(
                          attributeDefinition)}}:&nbsp;
                      </label>
                      <ng-container *ngIf="object[attributeDefinition.
                        propertyName]">
                        <!--
                          Remove the "disabled" attribute below once ItemProxy
                          selection can be restricted by kind.
                        -->
                        <button mat-raised-button (click)="openObjectEditor(
                          attributeDefinition.propertyName)" style="width:
                          100%; margin: 0px 3px 0px 3px;" [disabled]="true">
                          {{getStringRepresentation(undefined,
                            attributeDefinition.propertyName)}}
                        </button>
                      </ng-container>
                      <button mat-icon-button matTooltip="Select an object"
                        [disabled]="(!attributeDefinition.editable ||
                        isDisabled)" (click)="openObjectSelector(
                        attributeDefinition.propertyName)"
                        style="margin-left: auto;">
                        <mat-icon class="fa fa-ellipsis-h"></mat-icon>
                      </button>
                      <button mat-icon-button
                        matTooltip="Remove the selection for
                        {{attributeDefinition.propertyName}}"
                        [disabled]="(!attributeDefinition.editable ||
                        isDisabled || (object[attributeDefinition.
                        propertyName] == null))" (click)="object[
                        attributeDefinition.propertyName] = undefined">
                        <mat-icon class="fa fa-times"></mat-icon>
                      </button>
                    </div>
                  </ng-template>
                </ng-container>
              </ng-container>
            </ng-container>
          </ng-template>
        </ng-container>
      </div>
    </ng-template>
  </ng-container>
</div>
<ng-container *ngIf="isDialogInstance()">
  <mat-dialog-actions style="height: 40px; width: 100%; display: flex;
    flex-direction: row;">
    <button mat-raised-button [disabled]="!isObjectValid()" (click)="close(
      true)" style="margin-left: auto;">
      Accept
    </button>
    <button mat-raised-button (click)="close(false)">
      Cancel
    </button>
  </mat-dialog-actions>
</ng-container>