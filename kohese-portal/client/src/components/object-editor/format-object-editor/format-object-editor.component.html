<div style="width: 100%; overflow: auto; padding: 7px;" [ngStyle]="{ 'height':
  isDialogInstance() ? '90%' : '100%' }">
  <ng-container *ngFor="let container of formatDefinition.containers">
    <ng-container *ngIf="(container.kind === FormatContainerKind.
      REVERSE_REFERENCE_TABLE) else notReverseReferencesTable">
      <h3>
        Reverse References For {{getReverseReferenceTableHeaderContent(
          container)}}
      </h3>
      <table_ [rows]="getReverseReferences(container)"
        [getName]="getReverseReferenceName" [columns]="['name']"
        [disabled]="true">
      </table_>
    </ng-container>
    <ng-template #notReverseReferencesTable>
      <div style="display: flex;" [ngStyle]="{ 'flex-direction': ((container.
        kind === 'list') ? 'column' : 'row') }">
        <ng-container *ngFor="let attributeDefinition of container.contents">
          <ng-container *ngIf="Array.isArray(getAttribute(attributeDefinition).
            type) else singleValuedBlock">
            <ng-container *ngIf="(!isDisabled || (!attributeDefinition.
              hideEmpty || (object[attributeDefinition.propertyName.
              attribute] && (object[attributeDefinition.propertyName.
              attribute].length > 0))))">
              <ng-container *ngIf="attributeDefinition.tableDefinition else
                notTableBlock">
                <h3>
                  {{getAttributeRepresentation(attributeDefinition)}}
                </h3>
                <table_ [rows]="getTableElements(attributeDefinition)"
                  [getName]="getTableElementName" [columns]="getTableColumns(
                  attributeDefinition)" [add]="getTableElementAdditionFunction(
                  attributeDefinition)"
                  [move]="getTableElementMovementFunction(attributeDefinition)"
                  [remove]="getTableElementRemovalFunction(
                  attributeDefinition)" [disabled]="isDisabled">
                </table_>
              </ng-container>
              <ng-template #notTableBlock>
                <div style="display: flex; flex-direction: column;">
                  <div style="display: flex; flex-direction: row;">
                    <h3>
                      {{getAttributeRepresentation(attributeDefinition)}}
                    </h3>
                    <button mat-icon-button matTooltip="Add a value to
                      {{attributeDefinition.propertyName.attribute}}"
                      class="flex-right-align" [disabled]="isDisabled"
                      (click)="addValue(attributeDefinition)">
                      <mat-icon class="fa fa-plus"></mat-icon>
                    </button>
                  </div>
                  <mat-list>
                    <ng-container *ngFor="let value of object[
                      attributeDefinition.propertyName.attribute]; let j =
                      index">
                      <mat-list-item>
                        {{getStringRepresentation(j, attributeDefinition.
                          propertyName.attribute)}}
                        <span class="flex-right-align">
                          <button mat-icon-button matTooltip="Edit this value"
                            [disabled]="isDisabled" (click)="editValue(j,
                            attributeDefinition)">
                            <mat-icon class="fa fa-edit"></mat-icon>
                          </button>
                          <button mat-icon-button matTooltip="Remove this
                            value" [disabled]="isDisabled"
                            (click)="removeValue(j, attributeDefinition.
                            propertyName.attribute)">
                            <mat-icon class="fa fa-trash"></mat-icon>
                          </button>
                        </span>
                      </mat-list-item>
                    </ng-container>
                  </mat-list>
                </div>
              </ng-template>
              <br/>
            </ng-container>
          </ng-container>
          <ng-template #singleValuedBlock>
            <ng-container *ngIf="(!isDisabled || (!attributeDefinition.
              hideEmpty || ((object[attributeDefinition.propertyName.
              attribute] != null) && (object[attributeDefinition.propertyName.
              attribute] !== ''))))">
              <ng-container [ngSwitch]="attributeDefinition.kind">
                <ng-container *ngSwitchCase="'boolean'">
                  <mat-checkbox [(ngModel)]="object[attributeDefinition.
                    propertyName.attribute]" [disabled]="isDisabled"
                    style="width: 100%;">
                    {{getAttributeRepresentation(attributeDefinition)}}
                  </mat-checkbox>
                </ng-container>
                <ng-container *ngSwitchCase="'number'">
                  <mat-form-field style="width: 100%;">
                    <input matInput type="number"
                      placeholder="{{getAttributeRepresentation(
                      attributeDefinition)}}" [(ngModel)]="object[
                      attributeDefinition.propertyName.attribute]"
                      [disabled]="isDisabled"/>
                  </mat-form-field>
                </ng-container>
                <ng-container *ngSwitchCase="'date'">
                  <mat-form-field style="width: 100%;">
                    <input matInput type="date"
                      placeholder="{{getAttributeRepresentation(
                      attributeDefinition)}}" [(ngModel)]="object[
                      attributeDefinition.propertyName.attribute]"
                      [disabled]="isDisabled"/>
                  </mat-form-field>
                </ng-container>
                <ng-container *ngSwitchCase="'string'">
                  <mat-form-field style="width: 100%;">
                    <input matInput type="text"
                      placeholder="{{getAttributeRepresentation(
                      attributeDefinition)}}" [(ngModel)]="object[
                      attributeDefinition.propertyName.attribute]"
                      [disabled]="isDisabled"/>
                  </mat-form-field>
                </ng-container>
                <ng-container *ngSwitchCase="'markdown'">
                  <ng-container *ngIf="isDisabled else editableBlock">
                    <label style="width: 100%;">
                      {{getAttributeRepresentation(attributeDefinition)}}:
                    </label>
                    <markdown [data]="object[attributeDefinition.propertyName.
                      attribute]">
                    </markdown>
                  </ng-container>
                  <ng-template #editableBlock>
                    <markdown-editor [value]="object[attributeDefinition.
                      propertyName.attribute]"
                      [valueIdentifier]="getAttributeRepresentation(
                      attributeDefinition)" (valueChanged)="object[
                      attributeDefinition.propertyName.attribute] = $event">
                    </markdown-editor>
                    <br/>
                  </ng-template>
                </ng-container>
                <ng-container *ngSwitchCase="'state-editor'">
                  <div style="display: flex; flex-direction: row;">
                    <div style="display: flex; flex-direction: column;
                      justify-content: center;">
                      <label style="margin-bottom: unset;">
                        {{getAttributeRepresentation(attributeDefinition)}}:
                          {{object[attributeDefinition.propertyName.
                          attribute]}}&nbsp;
                      </label>
                    </div>
                    <ng-container *ngFor="let transitionCandidateName of
                      getStateTransitionCandidates(attributeDefinition);
                      let j = index">
                      <button mat-raised-button [disabled]="isDisabled"
                        style="margin: 0px 3px 0px 3px;"
                        [ngStyle]="{ 'margin-left': ((j === 0) ? 'auto' :
                        '') }" (click)="object[attributeDefinition.
                        propertyName.attribute] = getAttribute(
                        attributeDefinition).properties.transition[
                        transitionCandidateName].target">
                        {{transitionCandidateName}}
                      </button>
                    </ng-container>
                  </div>
                </ng-container>
                <ng-container *ngSwitchCase="'user-selector'">
                  <mat-form-field style="width: 100%;">
                    <mat-select placeholder="{{getAttributeRepresentation(
                      attributeDefinition)}}" [(ngModel)]="object[
                      attributeDefinition.propertyName.attribute]"
                      [disabled]="isDisabled">
                      <ng-container *ngFor="let username of usernames">
                        <mat-option [value]="username">
                          {{username}}
                        </mat-option>
                      </ng-container>
                    </mat-select>
                  </mat-form-field>
                </ng-container>
                <ng-container *ngSwitchDefault>
                  <ng-container *ngIf="getLocalType(attributeDefinition)
                    else globalTypeAttribute">
                    <label style="width: 100%;">
                      {{getAttributeRepresentation(
                        attributeDefinition)}}:&nbsp;
                    </label>
                    <br/>
                    <format-object-editor [type]="getLocalType(
                      attributeDefinition)" [viewModel]="getLocalTypeViewModel(
                      attributeDefinition)" [object]="object[
                      attributeDefinition.propertyName.attribute]"
                      [attributes]="getLocalTypeAttributes(
                      attributeDefinition)"
                      [formatDefinition]="getLocalTypeFormatDefinition(
                      attributeDefinition)" [disabled]="isDisabled">
                    </format-object-editor>
                  </ng-container>
                  <ng-template #globalTypeAttribute>
                    <div style="width: 100%; display: flex; flex-direction:
                      row;">
                      <label style="width: 20%;">
                        {{getAttributeRepresentation(
                          attributeDefinition)}}:&nbsp;
                      </label>
                      <ng-container *ngIf="object[attributeDefinition.
                        propertyName.attribute]">
                        <!--
                          Remove the "disabled" attribute below once ItemProxy
                          selection can be restricted by kind.
                        -->
                        <button mat-raised-button (click)="openObjectEditor(
                          attributeDefinition.propertyName.attribute)"
                          style="width: 60%;" [disabled]="true">
                          {{getStringRepresentation(undefined,
                            attributeDefinition.propertyName.attribute)}}
                        </button>
                      </ng-container>
                      <span class="flex-right-align" style="width: 20%;
                        display: flex; flex-direction: row;">
                        <button mat-icon-button matTooltip="Select an object"
                          [disabled]="isDisabled" (click)="openObjectSelector(
                          attributeDefinition.propertyName.attribute)"
                          class="flex-right-align">
                          <mat-icon class="fa fa-ellipsis-h"></mat-icon>
                        </button>
                        <button mat-icon-button
                          matTooltip="Remove the selection for
                          {{attributeDefinition.propertyName.attribute}}"
                          [disabled]="(isDisabled || (object[
                          attributeDefinition.propertyName.attribute] ==
                          null))" (click)="object[attributeDefinition.
                          propertyName.attribute] = undefined">
                          <mat-icon class="fa fa-times"></mat-icon>
                        </button>
                      </span>
                    </div>
                  </ng-template>
                </ng-container>
              </ng-container>
            </ng-container>
          </ng-template>
        </ng-container>
      </div>
    </ng-template>
  </ng-container>
</div>
<ng-container *ngIf="isDialogInstance()">
  <mat-dialog-actions style="height: 10%; width: 100%; display: flex;
    flex-direction: column;">
    <span class="flex-right-align">
      <button mat-raised-button (click)="close(true)">
        Accept
      </button>
      <button mat-raised-button (click)="close(false)">
        Cancel
      </button>
    </span>
  </mat-dialog-actions>
</ng-container>