<div class="users-page-wrapper"
[ngStyle]="{ 'height': ((lens === ApplicationLens.DEFAULT) ? 'calc(100% - 34px)' : 'calc(100% - 84px)') }">
  <ng-container *ngIf="sessionMap else initializing">
    <lens></lens>
    <div class="panel-heading">Admin</div>
    <split direction="horizontal">

      <split-area id="session-split" [size]="40">
        <div class="session-container">
          <div class="session-banner">
            <h2>Connections Active</h2>
          </div>
          <div class="session-content">
            <ng-container *ngFor="let session of Object.keys(sessionMap)">
              <div style="width: 100%;">
                {{sessionMap[session].username}} - {{sessionMap[session].address}}
                <ng-container *ngIf="sessionMap[session].numberOfConnections">
                  - {{sessionMap[session].numberOfConnections}} Connection{{
                  (sessionMap[session].numberOfConnections > 1) ? 's' : ''}}
                </ng-container>
              </div>
            </ng-container>
          </div>
        </div>
      </split-area>

      <split-area id="user-split" [size]="60">
        <div class="user-container">
          <h2 class="user-banner">
            Users
            <button mat-icon-button matTooltip="Expand all Users"
              style="margin-left: auto;"
              (click)="expandAll()">
              <mat-icon class="fa fa-chevron-down"></mat-icon>
            </button>
            <button mat-icon-button matTooltip="Collapse all Users"
              (click)="collapseAll()">
              <mat-icon class="fa fa-chevron-up"></mat-icon>
            </button>
            <button mat-icon-button matTooltip="Add a user"
              (click)="add()">
              <mat-icon class="fa fa-plus"></mat-icon>
            </button>
            <button mat-icon-button matTooltip="User Lockout List"
              (click)="getUserLockoutList(user)">
              <mat-icon class="fa fa-lock"></mat-icon>
            </button>
          </h2>
          <div class="user-panels">
            <ng-container *ngFor="let user of sessionService.users">
              <mat-expansion-panel #panel>
                <mat-expansion-panel-header [ngStyle]="{ 'background-color': koheseUserViewModel.color }">
                  <mat-panel-title>
                    <mat-icon class="{{koheseUserViewModel.icon}}" style="margin-right: 3px;"></mat-icon>
                    {{user.name}}
                  </mat-panel-title>
                  <mat-panel-description>
                    <ng-container *ngIf="isModified(user)">
                      <button mat-icon-button [disabled]="true" style="margin-left: auto;">
                        <img src="assets/icons/versioncontrol/dirty.ico" />
                      </button>
                    </ng-container>
                    <ng-container *ngIf="(editableSet.indexOf(user.id) === -1) else editableBlock">
                      <button mat-icon-button matTooltip="Edit this user"
                        [ngStyle]="{ 'margin-left': (isModified(user) ? '' : 'auto') }"
                        (click)="$event.stopPropagation(); panel.open(); editableSet.push(user.id)">
                        <mat-icon class="fa fa-edit"></mat-icon>
                      </button>
                    </ng-container>
                    <ng-template #editableBlock>
                      <button mat-icon-button matTooltip="Save this user"
                        [ngStyle]="{ 'margin-left': (isModified(user) ? '' : 'auto') }"
                        (click)="$event.stopPropagation(); save(user)">
                        <mat-icon class="fa fa-save"></mat-icon>
                      </button>
                      <button mat-icon-button matTooltip="Discard unsaved changes to this user"
                        (click)="$event.stopPropagation(); discardChanges(user)">
                        <mat-icon class="fa fa-times"></mat-icon>
                      </button>
                    </ng-template>

                    <button mat-icon-button matTooltip="Other Options" [matMenuTriggerFor]="menu"
                      (click)="$event.stopPropagation();">
                      <mat-icon class="fa fa-bars"></mat-icon>
                    </button>
                    <mat-menu #menu="matMenu" [overlapTrigger]="false">
                      <button mat-menu-item (click)="displayInformation(user)">
                        <mat-icon class="fa fa-clone"></mat-icon>
                        Display Item information
                      </button>
                      <button mat-menu-item
                        (click)="$event.stopPropagation(); navigationService.navigate('Explore', { id: user.id })">
                        <mat-icon class="fa fa-arrow-right"></mat-icon>
                        Navigate in Explorer
                      </button>
                      <button mat-menu-item
                        (click)="$event.stopPropagation(); navigationService.addTab('Explore', { id: user.id })">
                        <mat-icon class="fa fa-external-link"></mat-icon>
                        Navigate in New Tab
                      </button>
                      <mat-divider></mat-divider>
                      <button mat-menu-item (click)="lockUser(user)">
                        <mat-icon class="fa fa-lock"></mat-icon>
                        Lock User
                      </button>
                      <button mat-menu-item (click)="reinstateUser(user)">
                        <mat-icon class="fa fa-unlock"></mat-icon>
                        Unlock User
                      </button>
                      <button mat-menu-item (click)="remove(user)">
                        <mat-icon class="fa fa-trash"></mat-icon>
                        Remove This User
                      </button>
                    </mat-menu>
                  </mat-panel-description>
                </mat-expansion-panel-header>
                <ng-template matExpansionPanelContent>
                  <format-object-editor
                    [type]="koheseUserDataModel"
                    [object]="user"
                    [formatDefinitionType]="FormatDefinitionType.DEFAULT"
                    [disabled]="(editableSet.indexOf(user.id) === -1)">
                  </format-object-editor>
                </ng-template>
              </mat-expansion-panel>
            </ng-container>
          </div>
        </div>
      </split-area>

    </split>
  </ng-container>
  <ng-template #initializing>
    <div class="initialize-spinner">
      <mat-spinner mode="indeterminate"></mat-spinner>
    </div>
  </ng-template>

</div>
