<div style="height: 100%; width: 100%; padding: 3px;">
  <split direction="vertical">
    <split-area [size]="50">
      <split direction="horizontal">
        <split-area [size]="30">
          <tree #itemProxyTree [root]="TreeConfiguration.getWorkingTree().
            getRootProxy()" [getChildren]="getChildren" [getText]="getText"
            (elementSelected)="addReportSelection($event)">
          </tree>
        </split-area>
        <split-area [size]="30">
          <div style="height: 10%; width: 100%; display: flex;
            flex-direction: row;">
            <mat-form-field style="width: 70%;">
              <mat-select #documentConfigurationSelect
                placeholder="Document Configuration"
                [ngModel]="selectedDocumentConfiguration"
                (ngModelChange)="selectedDocumentConfiguration = $event;
                updateReportPreview()">
                <mat-option [value]="''">
                  Default Document Configuration
                </mat-option>
                <ng-container *ngFor="let documentConfiguration of
                  documentConfigurations">
                  <mat-option [value]="documentConfiguration">
                    {{documentConfiguration.name}}
                  </mat-option>
                </ng-container>
              </mat-select>
            </mat-form-field>
            <button mat-icon-button
              matTooltip="Add a Document Configuration"
              class="flex-right-align"
              (click)="editDocumentConfiguration(undefined)">
              <mat-icon class="fa fa-plus"></mat-icon>
            </button>
            <button mat-icon-button
              matTooltip="Edit this Document Configuration"
              [disabled]="!selectedDocumentConfiguration"
              (click)="editDocumentConfiguration(
              selectedDocumentConfiguration)">
              <mat-icon class="fa fa-edit"></mat-icon>
            </button>
            <button mat-icon-button
              matTooltip="Remove this Document Configuration"
              [disabled]="!selectedDocumentConfiguration"
              (click)="removeSelectedDocumentConfiguration()">
              <mat-icon class="fa fa-trash"></mat-icon>
            </button>
          </div>
          <mat-list style="height: 85%; width: 100%; overflow: auto;">
            <ng-container *ngFor="let reportSelection of reportSelections">
              <mat-list-item>
                {{reportSelection.itemProxy.item.name}}
                <button mat-icon-button matTooltip="Include descendants"
                  class="flex-right-align"
                  [ngClass]="{ 'highlight': reportSelection.
                  includeDescendants }" (click)="reportSelection.
                  includeDescendants = !reportSelection.includeDescendants;
                  updateReportPreview()">
                  <mat-icon class="fa fa-arrow-circle-o-down"></mat-icon>
                </button>
                <button mat-icon-button matTooltip="Move this Item up"
                  [disabled]="getReportSelectionsIndex(reportSelection.
                  itemProxy) === 0" (click)="move(MoveDirection.UP,
                  reportSelection); updateReportPreview()">
                  <mat-icon class="fa fa-arrow-up"></mat-icon>
                </button>
                <button mat-icon-button matTooltip="Move this Item down"
                  [disabled]="getReportSelectionsIndex(reportSelection.
                  itemProxy) === reportSelections.length - 1" (click)="move(
                  MoveDirection.DOWN, reportSelection); updateReportPreview()">
                  <mat-icon class="fa fa-arrow-down"></mat-icon>
                </button>
                <button mat-icon-button matTooltip="Deselect this Item"
                  (click)="reportSelections.splice(getReportSelectionsIndex(
                  reportSelection.itemProxy), 1); updateReportPreview()">
                  <mat-icon class="fa fa-trash"></mat-icon>
                </button>
              </mat-list-item>
            </ng-container>
          </mat-list>
        </split-area>
        <split-area [size]="40">
          <div style="height: 15%; width: 100%; padding: 3px; display: flex;
            flex-direction: row;">
            <mat-form-field style="width: 40%; padding: 3px;">
              <input matInput type="text" #reportNameInput
                placeholder="Report Name"/>
            </mat-form-field>
            <mat-form-field style="width: 20%; padding: 3px;">
              <mat-select #reportFormatSelect placeholder="Report Format"
                [value]="ReportFormat.DOCX">
                <ng-container *ngFor="let reportFormatKey of (ReportFormat |
                  mapKey)">
                  <mat-option [value]="ReportFormat[reportFormatKey]">
                    {{ReportFormat[reportFormatKey]}}
                  </mat-option>
                </ng-container>
              </mat-select>
            </mat-form-field>
            <mat-checkbox #saveCheckbox [checked]="true">
              Save
            </mat-checkbox>
            <button mat-button
              matTooltip="Produce a report in the selected format"
              class="flex-right-align" [disabled]="!canProduceReport(
              reportNameInput.value)" (click)="produceReport(reportNameInput.
              value, reportFormatSelect.selected.value, (saveCheckbox.checked ?
              undefined : unsavedDownloadAnchor))"
              style="padding: 3px;">
              Produce
            </button>
            <a #unsavedDownloadAnchor style="display: none;"></a>
          </div>
          <div style="height: 85%; width: 100%; overflow: auto;">
            <markdown [data]="report"></markdown>
          </div>
        </split-area>
      </split>
    </split-area>
    <split-area [size]="50">
      <h3>
        Reports
      </h3>
      <mat-accordion multi="true">
        <ng-container *ngFor="let reportName of Array.from(reports.keys())">
          <mat-expansion-panel (opened)="retrieveSavedReportPreview(
            reportName)">
            <mat-expansion-panel-header>
              <mat-panel-title style="align-items: center;">
                {{reportName}}
              </mat-panel-title>
              <span class="flex-right-align">
                <button mat-icon-button matTooltip="Rename this report"
                  (click)="renameReport(reportName); $event.stopPropagation()">
                  <mat-icon class="fa fa-i-cursor"></mat-icon>
                </button>
                <a #reportDownloadAnchor style="display: none;"
                  download="{{reportName}}" href="{{'/producedReports/' +
                  reportName}}" (click)="$event.stopPropagation()">
                </a>
                <button mat-icon-button matTooltip="Download this report"
                  (click)="reportDownloadAnchor.click(); $event.
                  stopPropagation()">
                  <mat-icon class="fa fa-download"></mat-icon>
                </button>
                <button mat-icon-button matTooltip="Remove this report"
                  (click)="removeReport(reportName); $event.stopPropagation()">
                  <mat-icon class="fa fa-trash"></mat-icon>
                </button>
              </span>
            </mat-expansion-panel-header>
            <ng-template matExpansionPanelContent>
              <ng-container *ngIf="reportName.endsWith('.md') else
                notMarkdownReport">
                <pre
                  style="font-family: Roboto, 'Helvetica Neue', sans-serif;">{{reports.
                  get(reportName)}}</pre>
              </ng-container>
              <ng-template #notMarkdownReport>
                <markdown [data]="reports.get(reportName)"></markdown>
              </ng-template>
            </ng-template>
          </mat-expansion-panel>
        </ng-container>
      </mat-accordion>
    </split-area>
  </split>
</div>