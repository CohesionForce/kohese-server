<!--
Copyright (c) 2021 CohesionForce Inc | www.CohesionForce.com | info@CohesionForce.com

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->


<button mat-raised-button style="background-color: rgb(0, 160, 223); color : white;" class=copy-button
  (click)=copyToClipboard(selectedAssignments)>
  Copy Statistics to Clipboard
</button>
<mat-checkbox [(ngModel)]=useStates style="float: right; padding-right : 20px"
  (change)=buildSelectedAssignments()>
  State Filter
</mat-checkbox>
<div *ngIf=project class=statistics-grid-container>
  <div class=left-content>
    <button mat-raised-button (click)=selectAll()>Select All</button>
    <button mat-raised-button (click)=deselectAll()>Select None</button>
    <mat-list>
      <mat-list-item *ngFor="let user of project.users" style="border: 1px solid black; padding : 10px;"
        (click)=toggleUser(user) [ngClass]="{'selected-user' : selectedUserMap.get(user.item.name)}">
        <mat-icon class="fa fa-user"></mat-icon>{{ user.item.name}}
      </mat-list-item>
    </mat-list>
  </div>
  <div class=middle-content style="overflow: auto">
    <mat-table *ngIf=selectedAssignments [dataSource]=tableStream>
      <ng-container matColumnDef=kind>
        <mat-header-cell *matHeaderCellDef> Kind </mat-header-cell>
        <mat-cell *matCellDef="let assignment"> {{assignment.kind}}</mat-cell>
      </ng-container>
      <ng-container matColumnDef=name>
        <mat-header-cell *matHeaderCellDef> Name </mat-header-cell>
        <mat-cell *matCellDef="let assignment"> {{assignment.item.name}}</mat-cell>
      </ng-container>

      <ng-container matColumnDef=state>
        <mat-header-cell *matHeaderCellDef> State </mat-header-cell>
        <mat-cell *matCellDef="let assignment">{{assignment.state}}</mat-cell>
      </ng-container>

      <ng-container matColumnDef=assignedTo>
        <mat-header-cell *matHeaderCellDef> Assigned To </mat-header-cell>
        <mat-cell *matCellDef="let assignment"> {{assignment.item.assignedTo}}</mat-cell>
      </ng-container>

      <mat-header-row *matHeaderRowDef="rowDef; sticky: true"></mat-header-row>
      <mat-row (click)=openProxyDetails(proxy) *matRowDef="let proxy; columns: rowDef; let j=index;" tabindex="{{j}}"></mat-row>
    </mat-table>
  </div>
  <div class=right-content *ngIf=useStates>
    <div *ngFor="let type of supportedTypes">
      <h5 style="border-bottom : 1px darkgrey solid; padding-top : 10px">{{type}}</h5>
      <div *ngFor="let stateType of stateInfo[type] | mapKey">
        <h6>{{stateType}}</h6>
        <mat-list>
          <mat-list-item class=state-item *ngFor="let state of stateInfo[type][stateType].states" (click)="toggleState(type, stateType, state)"
            [ngClass]="{'selected-state' : selectedStatesMap.get(stateType + state)}">
            {{state}}
          </mat-list-item>
        </mat-list>
      </div>
    </div>
  </div>
</div>
