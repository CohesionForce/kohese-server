<div class="panel" style="margin-bottom: 0px">
    <div class="panel-heading ">
        <span ng-if="detailsCtrl.itemProxy.kind">{{detailsCtrl.itemProxy.kind}} Information </span>
        <span ng-if="!detailsCtrl.itemProxy.kind">No Item Selected</span>
        <i ng-if="detailsCtrl.tab.type === 'singleview'" class="fa fa-clone pull-right"
           ui-sref="kohese.explore.edit({id:detailsCtrl.itemProxy.item.id})"
           ng-click="detailsCtrl.updateTab('edit', itemProxy.item.id, 'dualview')">
        </i>
        <i class="fa fa-arrows-alt pull-right" ng-if="detailsCtrl.tab.type === 'dualview'"
           ui-sref="kohese.investigate({id:detailsCtrl.itemProxy.item.id})"
           ng-click="detailsCtrl.updateTab('investigate', itemProxy.item.id, 'singleview')"></i>

    </div>
    <div class="panel-body">
        <!-- Nav tabs -->
        <tabset>
            <tab id="defaultTab" active="detailsCtrl.defaultTab.active">
                <tab-heading>Overview <span ng-show="detailsCtrl.itemForm.$dirty">(*)</span></tab-heading>
                <ng-include src="'components/common/templates/itemform.html'"></ng-include>
            </tab>
            <tab ng-if="detailsCtrl.itemProxy.kind === 'Action' || detailsCtrl.itemProxy.kind === 'Decision'"
                 class="decision-tab">
                <tab-heading>Decision</tab-heading>
                <form name="detailsCtrl.decisionForm">
                    <label class=control-label" for="DecisionState">
                        State:
                        <select id="DecisionState"
                                ng-model="detailsCtrl.itemProxy.item.decisionState" >
                            <option ng-repeat="state in detailsCtrl.decisionStates">{{state.item.name}}</option>
                        </select>
                    </label>
                    <label class=control-label">

                        Approved By:
                        <angucomplete-alt id="ApprovedBy"
                                          placeholder="{{detailsCtrl.itemProxy.item.approvedBy}}"
                                          selected-object="detailsCtrl.decisionApproved"
                                          search-fields="item.name,item.description"
                                          title-field="item.name"
                                          description-field="item.description"
                                          pause="100"
                                          local-data="detailsCtrl.userList"
                                          minlength="1"
                                          match-class="highlight"
                                ></angucomplete-alt>
                    </label>
                    <label class=control-label" for="ApprovedOn">
                        Approved On
                        <div class="controls">
                            <input ng-model="detailsCtrl.itemProxy.item.approvedOn" id="ApprovedOn">
                        </div>
                    </label>
                    <br/>
                    <label class=control-label" for="Rationale">
                        Rationale
                        <div class="controls">
                            <input id="Rationale" ng-model="detailsCtrl.itemProxy.item.rationale">
                        </div>
                    </label>
                    <br>
                    <label>
                        Alternatives:
                        <div ng-repeat="alternative in detailsCtrl.itemProxy.item.alternatives track by $index">
                            <input class="alternative-field" type="text" ng-model="alternative.text">
                        </div>
                        <button ng-click="detailsCtrl.addAlternative()" class="btn btn-primary">Add</button>
                    </label>
                </form>
            </tab>
            <tab ng-if="detailsCtrl.itemProxy.kind === 'Action'">
                <tab-heading>Action</tab-heading>
                <form name="detailsCtrl.actionForm">
                    <label class=control-label" for="ActionState">
                        State:
                        <select id="ActionState"
                                ng-model="detailsCtrl.itemProxy.item.actionState" >
                            <option ng-repeat="state in detailsCtrl.actionStates">{{state.item.name}}</option>
                        </select>
                    </label>
                    </label>
                    <label class=control-label">
                        Assigned To:
                            <angucomplete-alt id="AssignedTo"
                                              placeholder="{{detailsCtrl.itemProxy.item.assignedTo}}"
                                              selected-object="detailsCtrl.actionAssigned"
                                              search-fields="item.name,item.description"
                                              title-field="item.name"
                                              description-field="item.description"
                                              pause="100"
                                              local-data="detailsCtrl.userList"
                                              minlength="1"
                                              match-class="highlight"
                                    ></angucomplete-alt>
                    </label>
                    <br>
                    <label class=control-label" for="EstimatedStart">
                        Estimated Start:
                        <div class="controls">
                            <input ng-model="detailsCtrl.itemProxy.item.estimatedStart" id="EstimatedStart">
                        </div>
                    </label>
                    <label class=control-label" for="EstimatedCompletion">
                        Estimated Completion:
                        <div class="controls">
                            <input ng-model="detailsCtrl.itemProxy.item.estimatedCompletion" id="EstimatedCompletion">
                        </div>
                    </label>
                    <label class=control-label" for="EstimatedHours">
                        Estimated Hours:
                        <div class="controls">
                            <input ng-model="detailsCtrl.itemProxy.item.estimatedHoursEffort" id="EstimatedHours">
                        </div>
                    </label>
                    <br>
                    <label class=control-label" for="ActualStart">
                        Actual Start:
                        <div class="controls">
                            <input ng-model="detailsCtrl.itemProxy.item.actualStart" id="ActualStart">
                        </div>
                    </label>
                    <label class=control-label" for="ActualCompletion">
                        Actual Completion:
                        <div class="controls">
                            <input ng-model="detailsCtrl.itemProxy.item.actualCompletion" id="ActualCompletion">
                        </div>
                    </label>
                    <label class=control-label" for="ActualHours">
                        Actual Hours:
                        <div class="controls">
                            <input ng-model="detailsCtrl.itemProxy.item.actualHoursEfforts" id="ActualHours">
                        </div>
                    </label>
                </form>
            </tab>
            <tab heading="Children ({{detailsCtrl.itemProxy.children.length}})">
                <ng-include src="'components/detailsview/subviews/item.html'"></ng-include>
            </tab>
            <tab heading="Relations">
                <h4>Relations Tab</h4>

                <p><b>This tab is under construction.</b></p>
            </tab>
            <tab heading="Analysis" select="detailsCtrl.fetchAnalysis()">
		        <span class="pull-right">
                    <button ng-click="detailsCtrl.getLastFilter()" class="btn btn-default fa fa-chevron-left"> Last
                        Filter
                    </button>
					<input class="input-sm" type="text" ng-model="detailsCtrl.analysisFilterInput"
                           placeholder="Filter" style="margin: 5px"/>
                    <button ng-click="detailsCtrl.submitFilter()" class=" btn btn-default fa fa-search"> Submit</button>
				</span>

                <h4>Analysis Summary</h4>
                <input type="checkbox" ng-model="detailsCtrl.showChunksinSummary"
                       ng-init="detailsCtrl.showChunksinSummary=false" name="showChunksInSummaryInput"
                       style="margin: 5px"/> Show Chunks in Summary
                <input type="checkbox" ng-model="detailsCtrl.showTokensinSummary"
                       ng-init="detailsCtrl.showTokensinSummary=true" name="showTokensInSummaryInput"
                       style="margin: 5px"/> Show Tokens in Summary
                <table
                        class="table tree-grid table-striped table-condensed table-hover">
                    <thead>
                    <th><a href="" ng-click="itemSortField = 'Text'">Text</a></th>
                    <th><a href="" ng-click="itemSortField = 'Type'">Type</a></th>
                    <th><a href="" ng-click="itemSortField = 'Count'">Count</a></th>
                    </thead>
                    <tbody>
                    <tr class="tree-grid-row" id="Chunk:{{summary.text}}"
                        ng-hide="((summary.displayType == 'Chunk') && !detailsCtrl.showChunksinSummary) || ((summary.displayType == 'Token') && !detailsCtrl.showTokensinSummary)"
                        ng-repeat="summary in detailsCtrl.itemProxy.analysis.extendedSummaryList | filter:{text:detailsCtrl.analysisFilterString} | orderBy:['-count','text']">
                        <td ng-click="detailsCtrl.analysisFilterString = summary.text "
                            ng-bind-html="summary.text | highlight:detailsCtrl.analysisFilterString"></td>
                        <td>{{summary.displayType}}</td>
                        <td>{{summary.count}} - {{summary.posCount}}</td>
                    </tr>
                    </tbody>
                </table>

                <h4>Analysis Details</h4>
                <input type="checkbox" ng-model="detailsCtrl.showChunksInDetails"
                       ng-init="detailsCtrl.showChunksInDetails=false" name="showChunksInDetailsInput"
                       style="margin: 5px"/> Show Chunks in Details
                <input type="checkbox" ng-model="detailsCtrl.showTokensInDetails"
                       ng-init="detailsCtrl.showTokensInDetails=false" name="showTokensInDetailsInput"
                       style="margin: 5px"/> Show Tokens in Details
                <table
                        class="table tree-grid table-striped table-condensed table-hover">
                    <thead>
                    <th style="width:20%"><a href="" ng-click="itemSortField = 'Type'">Type</a></th>
                    <th><a href="" ng-click="itemSortField = 'Text'">Text</a></th>
                    <th><a href="" ng-click="itemSortField = 'Begin'">Begin</a></th>
                    <th><a href="" ng-click="itemSortField = 'End'">End</a></th>
                    </thead>
                    <tbody>
                    <tr class="level-{{listItem.displayLevel}}"
                        ng-hide="((listItem.displayLevel == 2) && !detailsCtrl.showChunksInDetails) || ((listItem.displayLevel == 3) && !detailsCtrl.showTokensInDetails)"
                        class="tree-grid-row" id="{{listItem.displayId}}"
                        ng-repeat="listItem in detailsCtrl.itemProxy.analysis.extendedList | filter:{text:detailsCtrl.analysisFilterString}">
                        <td class="indented">{{listItem.displayType}}</td>
                        <td ng-bind-html="listItem.text | highlight:detailsCtrl.analysisFilterString"></td>
                        <td>{{listItem.begin}}</td>
                        <td>{{listItem.end}}</td>
                    </tr>
                    </tbody>
                </table>
            </tab>
            <tab heading="History">
                <h4>History Tab</h4>

                <label>Created by: {{detailsCtrl.itemProxy.item.createdBy}}</label>
                <br/>
                <label>Created on: {{detailsCtrl.itemProxy.item.createdOn | date:'medium'}}</label>
                <br/>
                <label>Modified by: {{detailsCtrl.itemProxy.item.modifiedBy}}</label>
                <br/>
                <label>Modified on: {{detailsCtrl.itemProxy.item.modifiedOn | date:'medium'}}</label>

            </tab>
            <tab heading="Journal">
                <h4>Journal Tab</h4>

                <p><b>This tab is under construction.</b></p>
            </tab>
        </tabset>
    </div>
    <div class="form-actions">
        <button ng-click="detailsCtrl.enableEdit=true" ng-disabled="detailsCtrl.enableEdit" class="btn btn-primary">
            Edit
        </button>
        <button ng-click="detailsCtrl.upsertItem()"
                ng-disabled="!detailsCtrl.enableEdit || detailsCtrl.itemForm.$pristine
                && detailsCtrl.actionForm.$pristine && detailsCtrl.decisionForm.$pristine" class="btn btn-primary">
            Update
        </button>
        <button ng-click="detailsCtrl.enableEdit=false; detailsCtrl.cancel()" ng-disabled="!detailsCtrl.enableEdit"
                class="btn btn-primary">
            Cancel
        </button>
        <!-- /.panel-body -->
    </div>
    <!-- /.panel -->
</div>