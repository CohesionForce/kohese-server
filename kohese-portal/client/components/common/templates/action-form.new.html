<div ng-init="detailsCtrl.itemProxy.item.decisionState = 'Proposed'">
    <h3>
        Status: {{detailsCtrl.currentState}}
    </h3>
    <br>

    <div class="text-center" ng-if="detailsCtrl.itemProxy.item.actionState === 'Assigned'
                                    && detailsCtrl.currentUser === detailsCtrl.itemProxy.item.assignedTo">
        Do you you accept this assignment?
        <br>
        <button ng-click="detailsCtrl.updateState('Accepted', 'Action')"
                class="btn btn-primary">Yes
        </button>
        <button ng-click="detailsCtrl.updateState('Pending Reassign', 'Action')" class="btn btn-danger">No
        </button>
    </div>
    <div ng-if="detailsCtrl.itemProxy.item.actionState === 'Pending Reassign'"
         class="text-center">
        Action requires assignment:
        <label class=control-label">
            Assign To:
            <angucomplete-alt id="AssignedTo"
                              disable-input="!detailsCtrl.enableEdit"
                              placeholder="{{detailsCtrl.itemProxy.item.assignedTo}}"
                              selected-object="detailsCtrl.actionAssigned"
                              search-fields="item.name,item.description"
                              title-field="item.name"
                              description-field="item.description"
                              pause="100"
                              local-data="detailsCtrl.userList"
                              minlength="1"
                              match-class="highlight"
                    ></angucomplete-alt>
            <button ng-click="detailsCtrl.updateState('Assigned', 'Action')"
            class="btn btn-primary">Assign
            </button>
        </label>
    </div>

    <accordion>
        <accordion-group heading="Proposed"
                         is-open="detailsCtrl.accordion.Proposed">
            <ng-include src="'components/common/templates/itemform.html'"></ng-include>
            <label class=control-label" for="Rationale">
                Rationale
                <div class="controls">
                    <input id="Rationale"
                           ng-disabled="!detailsCtrl.enableEdit"
                           ng-model="detailsCtrl.itemProxy.item.rationale">
                </div>
            </label>
            <br>
            <label>
                Alternatives:
                <div ng-repeat="alternative in detailsCtrl.itemProxy.item.alternatives track by $index">
                    <input class="alternative-field"
                           type="text"
                           ng-disabled="!detailsCtrl.enableEdit"
                           ng-model="alternative.text">
                </div>
                <button ng-click="detailsCtrl.incrementItemInput('alternatives')"
                        ng-show="detailsCtrl.enableEdit"
                        class="btn btn-primary">Add
                </button>
            </label>
            <br>
            <button ng-click="detailsCtrl.updateState('In Analysis', 'Decision')"
                    class="btn btn-primary">Request Analysis
            </button>
        </accordion-group>
        <accordion-group heading="In Analysis"
                         is-open="detailsCtrl.accordion.InAnalysis">
            <div>
                <label class="control-label three-columns">
                    Estimated Start:
            <span class="input-group ">
                <input type="text"
                       class="form-control"
                       datepicker-popup="dd-MMMM-yyyy"
                       ng-model="detailsCtrl.itemProxy.item.estimatedStart"
                       ng-change="detailsCtrl.convertDate('estimatedStart')"
                       is-open="detailsCtrl.estimatedStart"
                       datepicker-options="detailsCtrl.dateOptions"
                       close-text="Close"/>
              <span class="input-group-btn">
                <button type="button" class="btn btn-default"
                        ng-click="detailsCtrl.openDatePicker($event, 'estimatedStart')">
                    <i class="glyphicon glyphicon-calendar"></i>
                </button>
              </span>
            </span>
                </label>
                <label class="three-columns control-label">
                    Estimated Completion:
            <span class="input-group">
                <input type="text"
                       class="form-control"
                       datepicker-popup="dd-MMMM-yyyy"
                       ng-model="detailsCtrl.itemProxy.item.estimatedCompletion"
                       ng-change="detailsCtrl.convertDate('estimatedCompletion', true)"
                       is-open="detailsCtrl.estimatedCompletion"
                       datepicker-options="detailsCtrl.dateOptions"
                       close-text="Close"/>
              <span class="input-group-btn">
                <button type="button" class="btn btn-default"
                        ng-click="detailsCtrl.openDatePicker($event, 'estimatedCompletion')">
                    <i class="glyphicon glyphicon-calendar"></i>
                </button>
              </span>
            </span>
                </label>
                <label class="control-label three-columns absolute">
                    Estimated Hours:
                    <br/>
                    <input class=""
                           ng-model="detailsCtrl.itemProxy.item.estimatedHoursEffort"
                           ng-disabled="!detailsCtrl.enableEdit">
                </label>
                <br>
            </div>
            <button ng-click="detailsCtrl.updateState('In Review','Decision')"
                    class="btn btn-primary">Request Review
            </button>
        </accordion-group>
        <accordion-group heading="In Review"
                         is-open="detailsCtrl.accordion.InReview">
            <label class="control-label three-columns">
                Approved By:
                <angucomplete-alt id="ApprovedBy"
                                  disable-input="!detailsCtrl.enableEdit"
                                  placeholder="{{detailsCtrl.itemProxy.item.approvedBy}}"
                                  selected-object="detailsCtrl.decisionApproved"
                                  search-fields="item.name,item.description"
                                  title-field="item.name"
                                  description-field="item.description"
                                  pause="100"
                                  local-data="detailsCtrl.userList"
                                  minlength="1"
                                  match-class="highlight"
                        ></angucomplete-alt>
            </label>
            <br/>
            <label class="control-label three-columns">
                Approved On:
                <div class="controls">
            <span class="input-group">
                <input type="text"
                       class="form-control"
                       datepicker-popup="dd-MMMM-yyyy"
                       ng-model="detailsCtrl.itemProxy.item.approvedOn"
                       ng-change="detailsCtrl.convertDate('approvedOn', true)"
                       is-open="detailsCtrl.approvedOn"
                       datepicker-options="detailsCtrl.dateOptions"
                       close-text="Close"/>
              <span class="input-group-btn">
                <button type="button" class="btn btn-default"
                        ng-click="detailsCtrl.openDatePicker($event, 'approvedOn')">
                    <i class="glyphicon glyphicon-calendar"></i>
                </button>
                  </span>
                </span>
                </div>
            </label>
            <br/>
            <button ng-click="detailsCtrl.updateState('Approved', 'Decision')"
                    class="btn btn-primary">Approve
            </button>
            <button ng-click="detailsCtrl.updateState('Disapproved', 'Decision')"
                    class="btn btn-danger">Disapprove
            </button>
            <button ng-click="detailsCtrl.updateState('Deferred', 'Decision')"
                    class="btn btn-default">Defer
            </button>
        </accordion-group>
        <accordion-group heading="Approved"
                         is-open="detailsCtrl.accordion.Approved">
            <label class=control-label">
                Assigned To:
                <angucomplete-alt id="AssignedTo"
                                  disable-input="!detailsCtrl.enableEdit"
                                  placeholder="{{detailsCtrl.itemProxy.item.assignedTo}}"
                                  selected-object="detailsCtrl.actionAssigned"
                                  search-fields="item.name,item.description"
                                  title-field="item.name"
                                  description-field="item.description"
                                  pause="100"
                                  local-data="detailsCtrl.userList"
                                  minlength="1"
                                  match-class="highlight"
                        ></angucomplete-alt>
            </label>
            <button ng-click="detailsCtrl.updateState('Assigned', 'Action')"
                    class="btn btn-primary">Assign
            </button>
        </accordion-group>

        <accordion-group heading="Accepted"
                         is-open="detailsCtrl.accordion.Accepted">
            <div>
                <label class="control-label three-columns">
                    Estimated Start:
            <span class="input-group ">
                <input type="text"
                       class="form-control"
                       datepicker-popup="dd-MMMM-yyyy"
                       ng-model="detailsCtrl.itemProxy.item.estimatedStart"
                       ng-change="detailsCtrl.convertDate('estimatedStart')"
                       is-open="detailsCtrl.estimatedStart"
                       datepicker-options="detailsCtrl.dateOptions"
                       close-text="Close"/>
              <span class="input-group-btn">
                <button type="button" class="btn btn-default"
                        ng-click="detailsCtrl.openDatePicker($event, 'estimatedStart')">
                    <i class="glyphicon glyphicon-calendar"></i>
                </button>
              </span>
            </span>
                </label>
                <label class="three-columns control-label">
                    Estimated Completion:
            <span class="input-group">
                <input type="text"
                       class="form-control"
                       datepicker-popup="dd-MMMM-yyyy"
                       ng-model="detailsCtrl.itemProxy.item.estimatedCompletion"
                       ng-change="detailsCtrl.convertDate('estimatedCompletion', true)"
                       is-open="detailsCtrl.estimatedCompletion"
                       datepicker-options="detailsCtrl.dateOptions"
                       close-text="Close"/>
              <span class="input-group-btn">
                <button type="button" class="btn btn-default"
                        ng-click="detailsCtrl.openDatePicker($event, 'estimatedCompletion')">
                    <i class="glyphicon glyphicon-calendar"></i>
                </button>
              </span>
            </span>
                </label>
                <label class="control-label three-columns absolute" for="EstimatedHours">
                    Estimated Hours:
                    <br/>
                    <input class=""
                           ng-model="detailsCtrl.itemProxy.item.estimatedHoursEffort"
                           ng-disabled="!detailsCtrl.enableEdit"
                           id="EstimatedHours">
                </label>
                <br>
                <button ng-click="detailsCtrl.updateState('In Work', 'Action')"
                        class="btn btn-primary">Begin Work
                </button>
            </div>
        </accordion-group>
        <accordion-group heading="In Work"
                         is-open="detailsCtrl.accordion.InWork">
            <label class="three-columns control-label">
                Actual Start:
            <span class="input-group">
                <input type="text"
                       class="form-control"
                       datepicker-popup="dd-MMMM-yyyy"
                       ng-model="detailsCtrl.itemProxy.item.actualStart"
                       ng-change="detailsCtrl.convertDate('actualStart')"
                       is-open="detailsCtrl.actualStart"
                       datepicker-options="detailsCtrl.dateOptions"
                       close-text="Close"/>
              <span class="input-group-btn">
                <button type="button" class="btn btn-default"
                        ng-click="detailsCtrl.openDatePicker($event, 'actualStart')">
                    <i class="glyphicon glyphicon-calendar"></i>
                </button>
                  </span>
                </span>
            </label>
            <label class="three-columns control-label">
                Actual Completion:
                <div class="controls">
            <span class="input-group">
                <input type="text"
                       class="form-control"
                       datepicker-popup="dd-MMMM-yyyy"
                       ng-model="detailsCtrl.itemProxy.item.actualCompletion"
                       ng-change="detailsCtrl.convertDate('actualCompletion', true)"
                       is-open="detailsCtrl.actualCompletion"
                       datepicker-options="detailsCtrl.dateOptions"
                       close-text="Close"/>
              <span class="input-group-btn">
                <button type="button" class="btn btn-default"
                        ng-click="detailsCtrl.openDatePicker($event, 'actualCompletion')">
                    <i class="glyphicon glyphicon-calendar"></i>
                </button>
                  </span>
                </span>
                </div>
            </label>
            <label class="control-label absolute three-columns" for="ActualHours">
                Actual Hours:
                <div class="controls">
                    <input ng-model="detailsCtrl.itemProxy.item.actualHoursEfforts"
                           ng-disabled="!detailsCtrl.enableEdit"
                           id="ActualHours">
                </div>
            </label>
            <br>
            <button ng-click="detailsCtrl.updateState('In Verification', 'Action')"
                    class="btn btn-primary">Request Verification
            </button>
        </accordion-group>
        <accordion-group heading="In Verification"
                         is-open="detailsCtrl.accordion.InVerification">
            Verified By:
            <angucomplete-alt id="VerifiedBy"
                              disable-input="!detailsCtrl.enableEdit"
                              placeholder="{{detailsCtrl.itemProxy.item.verifiedBy}}"
                              selected-object="detailsCtrl.verifiedBy"
                              search-fields="item.name,item.description"
                              title-field="item.name"
                              description-field="item.description"
                              pause="100"
                              local-data="detailsCtrl.userList"
                              minlength="1"
                              match-class="highlight"
                    ></angucomplete-alt>
            <br>
            <button ng-click="detailsCtrl.updateState('Verified', 'Action')"
                    class="btn btn-primary">Verify
            </button>

    </accordion>
</div>