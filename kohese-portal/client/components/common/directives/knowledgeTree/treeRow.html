<div
     class="kt-collection" ng-repeat="itemProxy in proxyCollection"
     ng-class="{'kt-hidden' : itemProxy.item.parentId && treeCtrl.collapsed[itemProxy.item.parentId]}"
     data-target="tree-menu-{{itemProxy.item.id}}"
     context-menu
        >
        
    <div class="kt-item"
         id="{{itemProxy.item.id}}"
         ng-init="lazyIdx=treeCtrl.allocateLazyItemIdx()"
         ng-class="{'kti-selected-item' : itemProxy.item.id === treeCtrl.selectedItemProxy.item.id,
                    'kti-filtered': !treeCtrl.matchesFilter(itemProxy) && !treeCtrl.childMatchesFilter(itemProxy),
                    'kti-filterMatchedExact': treeCtrl.matchesFilter(itemProxy, true),
                    'kti-filterMatched': treeCtrl.matchesFilter(itemProxy)}">
        <!-- Checkbox if item has a version control status -->
        <span ng-if="treeCtrl.versionControlEnabled && itemProxy.statusFlags">
        <input type="checkbox" 
               class="align-middle"
               ng-model="itemProxy.selected"
               ng-change="treeCtrl.onVersionControlStageChange(itemProxy)">
        </span>
        <!-- End conditional Checkbox for Version control -->
        <div class="kti-name"
                ng-style="{'font-weight': 'bold'}">
            <a style=""> <i
                    ng-click="treeCtrl.collapsed[itemProxy.item.id] = !treeCtrl.collapsed[itemProxy.item.id]"
                    ng-init="treeCtrl.initCollapsed(itemProxy.item.id)"
                    class="kt-icon"
                    ng-class="{'glyphicon fa icon-minus glyphicon-minus fa-minus': (itemProxy.children.length > 0) && !treeCtrl.collapsed[itemProxy.item.id],
                           'glyphicon fa icon-plus glyphicon-plus fa-plus': (itemProxy.children.length > 0) && treeCtrl.collapsed[itemProxy.item.id],
                           'glyphicon glyphicon-list-alt': !(itemProxy.children.length > 0),
                           'glyphicon glyphicon-th-list': (itemProxy.children.length > 0)}">
            </i>
            </a> &lt;{{itemProxy.kind}}&gt; <span class="kt-label"
                                                  ng-bind-html="(itemProxy.item.name | highlightRegex:treeCtrl.filter.textRegexHighlight)"
                                                  ng-click="treeCtrl.navigate('kohese.explore.edit', 'dualview', itemProxy.item.id)"></span>
                <span ng-if="itemProxy.item.tags"> {{itemProxy.item.tags}}</span>
                <!-- Conditional Icons for Item status -->
                <span ng-if="itemProxy.dirty"> **
                        <img src="resources/icons/versioncontrol/dirty.ico"
                             title = "Dirty item" />
                </span>
                <span ng-if="treeCtrl.versionControlEnabled"
                      ng-init="treeCtrl.applyVersionControlTags(itemProxy)"> 
                        <img    ng-if="itemProxy.statusFlags.WT_Modified"
                                src="resources/icons/versioncontrol/unstaged.ico"
                                title="Unstaged Item">
                        <img    ng-if="itemProxy.statusFlags.IndexModified"
                                src="resources/icons/versioncontrol/index-mod.ico"
                                title="Index Modified">
                </span>
        </div>
        <div class="kti-cell kti-actions pull-right"> 
            <i class="fa fa-anchor"
               ng-click="treeCtrl.updateRoot(itemProxy)"></i>
            <i class="glyphicon glyphicon-remove  pull-right"
               ng-click="treeCtrl.removeItem(itemProxy)"> </i>
        </div>
    </div>

    <div ng-if="itemProxy.children && (!treeCtrl.collapsed[itemProxy.item.id] || treeCtrl.previouslyExpanded[itemProxy.item.id] || (treeCtrl.allExpanded && (lazyIdx < treeCtrl.currentLazyLimit)))">
        <tree-row tree-ctrl="treeCtrl" proxy-collection="itemProxy.children"
                  ng-init="treeCtrl.previouslyExpanded[itemProxy.item.id]=true"></tree-row>
    </div>
    <!-- Dropdown menu-->
    <div class="dropdown position-fixed" id="tree-menu-{{itemProxy.item.id}}">
        <ul class="dropdown-menu" role="menu">
            <li class="pointer context-item"
                role="menuitem"
                ng-click="treeCtrl.updateRoot(itemProxy)">
                <a>
                    Set as root
                </a>
            </li>
            <li class="pointer context-item"
                role="menuitem"
                ui-sref="kohese.explore.create({parentId: itemProxy.item.id})">
                <a>
                    Create child
                </a>
            </li>
            <li class="pointer context-item"
                role="menuitem"
                ng-click="treeCtrl.collapseChildren(itemProxy)">
                <a>
                    Collapse children
                </a>
            </li>
            <li class="pointer context-item"
                role="menuitem"
                ng-click="treeCtrl.expandChildren(itemProxy)">
                <a>
                    Expand Children
                </a>
            </li>
            <li class="pointer context-item"
                role="menuitem"
                ng-click="treeCtrl.expandMatchingChildren(itemProxy)">
                <a>
                    Expand Matching Children
                </a>
            </li>
        </ul>
    </div>
</div>


